generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model budget_fringes {
  id              String          @id
  name            String
  fringeType      FringeType
  rate            Decimal         @db.Decimal(5, 4)
  isActive        Boolean         @default(true)
  sectionId       String
  budget_sections budget_sections @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
}

model budget_lines {
  id              String            @id
  lineNumber      Int
  description     String
  sortOrder       Int
  quantity        Decimal           @default(1) @db.Decimal(10, 2)
  rate            Decimal           @default(0) @db.Decimal(12, 2)
  days            Decimal           @default(1) @db.Decimal(10, 2)
  ot15Hours       Decimal           @default(0) @db.Decimal(10, 2)
  ot20Hours       Decimal           @default(0) @db.Decimal(10, 2)
  estimatedTotal  Decimal           @default(0) @db.Decimal(14, 2)
  notes           String?
  isContracted    Boolean           @default(false)
  sectionId       String
  budget_sections budget_sections   @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  project_crew    project_crew[]
  purchase_orders purchase_orders[]

  @@unique([sectionId, lineNumber])
  @@index([sectionId])
}

model budget_sections {
  id             String            @id
  code           String
  name           String
  sortOrder      Int
  sectionType    BudgetSectionType @default(LABOR)
  budgetId       String
  budget_fringes budget_fringes[]
  budget_lines   budget_lines[]
  budgets        budgets           @relation(fields: [budgetId], references: [id], onDelete: Cascade)

  @@unique([budgetId, code])
  @@index([budgetId])
}

model budgets {
  id              String            @id
  version         Int               @default(1)
  name            String
  status          BudgetStatus      @default(DRAFT)
  isActive        Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  lockedAt        DateTime?
  projectId       String
  createdById     String
  budget_sections budget_sections[]
  users           users             @relation(fields: [createdById], references: [id])
  projects        projects          @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, version])
  @@index([projectId])
  @@index([status])
}

model call_sheet_locations {
  id           String       @id
  locationType LocationType @default(SHOOT)
  callTime     DateTime?
  notes        String?
  callSheetId  String
  locationId   String
  call_sheets  call_sheets  @relation(fields: [callSheetId], references: [id], onDelete: Cascade)
  locations    locations    @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([callSheetId, locationId])
}

model call_sheet_rsvps {
  id                   String       @id
  createdAt            DateTime     @default(now())
  updatedAt            DateTime
  status               RSVPStatus   @default(PENDING)
  sentAt               DateTime?
  viewedAt             DateTime?
  confirmedAt          DateTime?
  personalizedCallTime DateTime?
  personalizedNotes    String?
  callSheetId          String
  projectCrewId        String
  call_sheets          call_sheets  @relation(fields: [callSheetId], references: [id], onDelete: Cascade)
  project_crew         project_crew @relation(fields: [projectCrewId], references: [id], onDelete: Cascade)

  @@unique([callSheetId, projectCrewId])
  @@index([callSheetId])
  @@index([projectCrewId])
  @@index([status])
}

model call_sheets {
  id                   String                 @id
  dayNumber            Int
  shootDate            DateTime
  status               CallSheetStatus        @default(DRAFT)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  generalCrewCall      DateTime?
  productionCall       DateTime?
  talentCall           DateTime?
  firstShot            DateTime?
  estimatedWrap        DateTime?
  weatherHigh          String?
  weatherLow           String?
  weatherSummary       String?
  sunrise              String?
  sunset               String?
  nearestHospital      String?
  hospitalAddress      String?
  emergencyContact     String?
  emergencyPhone       String?
  notes                String?
  projectId            String
  call_sheet_locations call_sheet_locations[]
  call_sheet_rsvps     call_sheet_rsvps[]
  projects             projects               @relation(fields: [projectId], references: [id], onDelete: Cascade)
  schedule_events      schedule_events[]

  @@unique([projectId, dayNumber])
  @@index([projectId])
  @@index([shootDate])
}

model crew_members {
  id             String         @id
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  firstName      String
  lastName       String
  email          String?
  phone          String?
  address        String?
  city           String?
  state          String?
  zip            String?
  department     Department?
  primaryRole    String?
  defaultRate    Decimal?       @db.Decimal(12, 2)
  unionStatus    UnionStatus    @default(NON_UNION)
  unionLocal     String?
  loanOutCompany String?
  w9OnFile       Boolean        @default(false)
  skills         String[]
  notes          String?
  isActive       Boolean        @default(true)
  organizationId String
  agentName      String?
  agentPhone     String?
  agentEmail     String?
  organizations  organizations  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project_crew   project_crew[]

  @@index([department])
  @@index([lastName, firstName])
  @@index([organizationId])
}

model locations {
  id                   String                 @id
  name                 String
  address              String?
  city                 String?
  state                String?
  zip                  String?
  latitude             Decimal?               @db.Decimal(10, 8)
  longitude            Decimal?               @db.Decimal(11, 8)
  mapLink              String?
  contactName          String?
  contactPhone         String?
  contactEmail         String?
  parkingNotes         String?
  parkingAddress       String?
  loadingNotes         String?
  accessNotes          String?
  arrivalInstructions  String?
  notes                String?
  projectId            String
  call_sheet_locations call_sheet_locations[]
  projects             projects               @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model organizations {
  id                     String         @id
  name                   String
  slug                   String         @unique
  createdAt              DateTime       @default(now())
  updatedAt              DateTime
  defaultInsuranceRate   Decimal        @default(0.03) @db.Decimal(5, 4)
  defaultPayrollTaxRate  Decimal        @default(0.23) @db.Decimal(5, 4)
  defaultWorkersCompRate Decimal        @default(0.02) @db.Decimal(5, 4)
  defaultAgencyFeeRate   Decimal        @default(0.17) @db.Decimal(5, 4)
  crew_members           crew_members[]
  projects               projects[]
  users                  users[]
  vendors                vendors[]
  clients                clients[]
}

model project_crew {
  id                  String             @id
  createdAt           DateTime           @default(now())
  updatedAt           DateTime
  role                String
  department          Department
  dealRate            Decimal            @db.Decimal(12, 2)
  dealType            DealType           @default(DAY_RATE)
  guaranteedDays      Decimal?           @db.Decimal(10, 2)
  kitFee              Decimal?           @db.Decimal(12, 2)
  perDiem             Decimal?           @db.Decimal(10, 2)
  status              CrewStatus         @default(HOLD)
  dealMemoSigned      Boolean            @default(false)
  startDate           DateTime?
  endDate             DateTime?
  dietaryRestrictions String?
  shirtSize           String?
  vehicleInfo         String?
  notes               String?
  projectId           String
  crewMemberId        String?
  budgetLineId        String?
  paymentType         PaymentType        @default(TIMECARD)
  onboardingStatus    OnboardingStatus   @default(NOT_STARTED)
  ndaSigned           Boolean            @default(false)
  btsConsent          Boolean            @default(false)
  isLoanOut           Boolean            @default(false)
  walkieAssigned      Boolean            @default(false)
  call_sheet_rsvps    call_sheet_rsvps[]
  budget_lines        budget_lines?      @relation(fields: [budgetLineId], references: [id])
  crew_members        crew_members?      @relation(fields: [crewMemberId], references: [id])
  projects            projects           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  timecards           timecards[]

  @@index([budgetLineId])
  @@index([crewMemberId])
  @@index([department])
  @@index([projectId])
}

model projects {
  id              String            @id
  status          ProjectStatus     @default(ACTIVE)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  jobNumber       String
  jobName         String
  client          String
  clientId        String?
  agency          String?
  brand           String?
  bidDate         DateTime?
  awardDate       DateTime?
  prepStartDate   DateTime?
  shootStartDate  DateTime?
  shootEndDate    DateTime?
  wrapDate        DateTime?
  insuranceRate   Decimal?          @db.Decimal(5, 4)
  payrollTaxRate  Decimal?          @db.Decimal(5, 4)
  workersCompRate Decimal?          @db.Decimal(5, 4)
  agencyFeeRate   Decimal?          @db.Decimal(5, 4)
  organizationId  String
  stageName       String?
  stageAddress    String?
  budgets         budgets[]
  call_sheets     call_sheets[]
  locations       locations[]
  project_crew    project_crew[]
  organizations   organizations     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  purchase_orders purchase_orders[]
  clients         clients?          @relation(fields: [clientId], references: [id])

  @@unique([organizationId, jobNumber])
  @@index([organizationId])
  @@index([status])
  @@index([clientId])
}

model purchase_orders {
  id                                        String        @id
  poNumber                                  String
  status                                    POStatus      @default(DRAFT)
  createdAt                                 DateTime      @default(now())
  updatedAt                                 DateTime
  description                               String
  amount                                    Decimal       @db.Decimal(14, 2)
  taxAmount                                 Decimal       @default(0) @db.Decimal(14, 2)
  totalAmount                               Decimal       @db.Decimal(14, 2)
  issueDate                                 DateTime?
  dueDate                                   DateTime?
  paidDate                                  DateTime?
  invoiceNumber                             String?
  paymentMethod                             String?
  paymentRef                                String?
  notes                                     String?
  projectId                                 String
  vendorId                                  String?
  budgetLineId                              String?
  createdById                               String
  approvedById                              String?
  approvedAt                                DateTime?
  users_purchase_orders_approvedByIdTousers users?        @relation("purchase_orders_approvedByIdTousers", fields: [approvedById], references: [id])
  budget_lines                              budget_lines? @relation(fields: [budgetLineId], references: [id])
  users_purchase_orders_createdByIdTousers  users         @relation("purchase_orders_createdByIdTousers", fields: [createdById], references: [id])
  projects                                  projects      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  vendors                                   vendors?      @relation(fields: [vendorId], references: [id])

  @@unique([projectId, poNumber])
  @@index([budgetLineId])
  @@index([projectId])
  @@index([status])
}

model schedule_events {
  id          String            @id
  sortOrder   Int
  time        DateTime
  endTime     DateTime?
  description String
  scene       String?
  location    String?
  notes       String?
  eventType   ScheduleEventType @default(GENERAL)
  callSheetId String
  call_sheets call_sheets       @relation(fields: [callSheetId], references: [id], onDelete: Cascade)

  @@index([callSheetId])
  @@index([time])
}

model timecards {
  id            String         @id
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  workDate      DateTime
  callTime      DateTime?
  wrapTime      DateTime?
  regularHours  Decimal        @default(0) @db.Decimal(5, 2)
  ot15Hours     Decimal        @default(0) @db.Decimal(5, 2)
  ot20Hours     Decimal        @default(0) @db.Decimal(5, 2)
  mealPenalty   Decimal        @default(0) @db.Decimal(10, 2)
  regularAmount Decimal        @default(0) @db.Decimal(12, 2)
  ot15Amount    Decimal        @default(0) @db.Decimal(12, 2)
  ot20Amount    Decimal        @default(0) @db.Decimal(12, 2)
  totalAmount   Decimal        @default(0) @db.Decimal(12, 2)
  status        TimecardStatus @default(DRAFT)
  notes         String?
  projectCrewId String
  submittedById String?
  submittedAt   DateTime?
  project_crew  project_crew   @relation(fields: [projectCrewId], references: [id], onDelete: Cascade)
  users         users?         @relation(fields: [submittedById], references: [id])

  @@index([projectCrewId])
  @@index([status])
  @@index([workDate])
}

model users {
  id                                                  String            @id
  email                                               String            @unique
  name                                                String
  hashedPassword                                      String?
  role                                                UserRole          @default(CREW)
  createdAt                                           DateTime          @default(now())
  updatedAt                                           DateTime
  organizationId                                      String
  budgets                                             budgets[]
  purchase_orders_purchase_orders_approvedByIdTousers purchase_orders[] @relation("purchase_orders_approvedByIdTousers")
  purchase_orders_purchase_orders_createdByIdTousers  purchase_orders[] @relation("purchase_orders_createdByIdTousers")
  timecards                                           timecards[]
  organizations                                       organizations     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model vendors {
  id              String            @id
  name            String
  contactName     String?
  email           String?
  phone           String?
  address         String?
  taxId           String?
  w9OnFile        Boolean           @default(false)
  notes           String?
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  organizationId  String
  purchase_orders purchase_orders[]
  organizations   organizations     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model clients {
  id            String    @id
  name          String
  contactName   String?
  email         String?
  phone         String?
  address       String?
  city          String?
  state         String?
  zip           String?
  notes         String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  organizationId String
  organizations organizations @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  projects      projects[]

  @@unique([organizationId, name])
  @@index([organizationId])
}

enum BudgetSectionType {
  LABOR
  EXPENSES
  TALENT
  PRODUCTION
  INSURANCE
}

enum BudgetStatus {
  DRAFT
  PENDING_REVIEW
  CLIENT_REVIEW
  APPROVED
  REVISED
}

enum CallSheetStatus {
  DRAFT
  REVIEW
  APPROVED
  DISTRIBUTED
}

enum CrewStatus {
  HOLD
  CONFIRMED
  CANCELLED
  WRAPPED
}

enum DealType {
  DAY_RATE
  WEEKLY_RATE
  FLAT_FEE
  HOURLY
}

enum Department {
  PRODUCTION
  CAMERA
  GRIP_ELECTRIC
  ART
  WARDROBE
  HAIR_MAKEUP
  SOUND
  LOCATIONS
  TRANSPORTATION
  CATERING
  POST_PRODUCTION
  TALENT
  STILLS
  VTR
  OTHER
}

enum PaymentType {
  TIMECARD
  INVOICE
}

enum OnboardingStatus {
  NOT_STARTED
  INVITED
  ONBOARDED
  NOT_APPLICABLE
}

enum FringeType {
  PAYROLL_TAX
  WORKERS_COMP
  INSURANCE
  AGENCY_FEE
  CUSTOM
}

enum LocationType {
  SHOOT
  BASECAMP
  CREW_PARKING
  TRUCK_PARKING
  CATERING
  HOLDING
  HOSPITAL
  HOTEL
  OTHER
}

enum POStatus {
  DRAFT
  PENDING
  APPROVED
  ISSUED
  RECEIVED
  INVOICED
  PAID
  CANCELLED
}

enum ProjectStatus {
  BID
  AWARDED
  ACTIVE
  WRAPPED
  CLOSED
  CANCELLED
}

enum RSVPStatus {
  PENDING
  SENT
  VIEWED
  CONFIRMED
  DECLINED
}

enum ScheduleEventType {
  CREW_CALL
  TALENT_CALL
  MEAL
  SHOOT
  COMPANY_MOVE
  WRAP
  GENERAL
}

enum TimecardStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  PROCESSED
  PAID
}

enum UnionStatus {
  NON_UNION
  IATSE
  TEAMSTERS
  SAG_AFTRA
  DGA
  WGA
  OTHER_UNION
}

enum UserRole {
  ADMIN
  PRODUCER
  COORDINATOR
  CREW
}
